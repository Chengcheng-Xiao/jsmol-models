<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>JSmol HTML5</title>

<style type="text/css">
	html {
		height: 100%;
	}
	body {
		height: 100%;
		overflow: hidden;
		margin: 0;
	}
	#appdiv {
		width:100%;
		height:100%;
	}
</style>

<script type="text/javascript" src="jsmol/JSmol.min.js"></script>
<script type="text/javascript" src="iframe-phone/dist/iframe-phone.js"></script>
<script type="text/javascript">

var jmolApplet0;

// logic is set by indicating order of USE -- default is HTML5 for this page, though
var use = "HTML5" // JAVA HTML5 WEBGL IMAGE  are all options
var s = document.location.search;

// Developers: The debugCode flag is checked in j2s/core/core.z.js, 
// and, if TRUE, skips loading the core methods, forcing those
// to be read from their individual directories. Set this
// true if you want to do some code debugging by inserting
// System.out.println, document.title, or alert commands
// anywhere in the Java or Jmol code.

Jmol.debugCode = (s.indexOf("debugcode") >= 0);

jmol_isReady = function(applet) {
	document.title = (applet._id + " - Jmol " + ___JmolVersion)
}

var Info = {
	width: "100%",
	height: "100%",
	debug: false,
	color: "0xFFFFFF",
	addSelectionOptions: false,
	serverURL: "http://chemapps.stolaf.edu/jmol/jsmol/php/jsmol.php",
	use: "HTML5",
	j2sPath: "jsmol/j2s",
	readyFunction: jmol_isReady,
	script: "set antialiasDisplay;load jsmol/data/caffeine.mol",
	//jarPath: "java",
	//jarFile: (useSignedApplet ? "JmolAppletSigned.jar" : "JmolApplet.jar"),
	//isSigned: useSignedApplet,
	disableJ2SLoadMonitor: true,
	disableInitialConsole: true,
	allowJavaScript: true
	//defaultModel: "$dopamine",
	//console: "none", // default will be jmolApplet0_infodiv
};

$(document).ready(function() {
  $("#appdiv").html(Jmol.getAppletHtml("jmolApplet0", Info))
});

/********************* integration with Lab *********************/

var phone = iframePhone.getIFrameEndpoint();
phone.addListener('play', function () {
	Jmol.script(jmolApplet0, 'spin on');
	// Notify iframe model that we received 'play' message and reacted appropriately.
	phone.post('play.iframe-model');
});
phone.addListener('stop', function () {
	Jmol.script(jmolApplet0, 'spin off');
	// Notify iframe model that we received 'stop' message and reacted appropriately.
	phone.post('stop.iframe-model');
});
phone.addListener('jmolScript', function (content) {
	Jmol.script(jmolApplet0, content);
});
// Initialize connection *after* listeners are added!
phone.initialize();

// Register Scripting API functions shortcuts. 
phone.post('registerScriptingAPIFunc', 'play');
phone.post('registerScriptingAPIFunc', 'stop');
phone.post('registerScriptingAPIFunc', 'jmolScript');

</script>
</head>
<body>
	<div id="appdiv"></div>
</body>
</html>
